#!/bin/bash

REPORT_FILE="vulnerability_report_$(date +%Y%m%d_%H%M%S).txt"

echo "=== Linux Security Vulnerability Assessment ===" > $REPORT_FILE
echo "Assessment Date: $(date)" >> $REPORT_FILE
echo "System: $(uname -a)" >> $REPORT_FILE
echo >> $REPORT_FILE

echo "=== SYSTEM INFORMATION ===" >> $REPORT_FILE
echo "Hostname: $(hostname)" >> $REPORT_FILE
echo "Uptime: $(uptime)" >> $REPORT_FILE
echo "Kernel Version: $(uname -r)" >> $REPORT_FILE
echo "Distribution: $(lsb_release -d 2>/dev/null || cat /etc/os-release | grep PRETTY_NAME)" >> $REPORT_FILE
echo >> $REPORT_FILE

echo "=== NETWORK CONFIGURATION ===" >> $REPORT_FILE
ip addr show >> $REPORT_FILE
echo >> $REPORT_FILE

echo "Listening Ports:" >> $REPORT_FILE
ss -tuln >> $REPORT_FILE
echo >> $REPORT_FILE

echo "=== USER ACCOUNTS ===" >> $REPORT_FILE
grep -E "(/bin/bash|/bin/sh|/bin/zsh)" /etc/passwd >> $REPORT_FILE
echo >> $REPORT_FILE

echo "Users with UID 0:" >> $REPORT_FILE
awk -F: '$3 == 0 {print $1}' /etc/passwd >> $REPORT_FILE
echo >> $REPORT_FILE

echo "=== FILE PERMISSIONS ===" >> $REPORT_FILE
find /etc -type f -perm -002 2>/dev/null >> $REPORT_FILE
echo >> $REPORT_FILE

echo "SUID Files:" >> $REPORT_FILE
find / -type f -perm -4000 2>/dev/null | head -20 >> $REPORT_FILE
echo >> $REPORT_FILE

echo "=== RUNNING SERVICES ===" >> $REPORT_FILE
systemctl list-units --type=service --state=running >> $REPORT_FILE
echo >> $REPORT_FILE

echo "=== FIREWALL STATUS ===" >> $REPORT_FILE
sudo iptables -L >> $REPORT_FILE

echo >> $REPORT_FILE
echo "Assessment completed. Report saved to: $REPORT_FILE"
